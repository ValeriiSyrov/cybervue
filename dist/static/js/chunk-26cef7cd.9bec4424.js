(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-26cef7cd"],{"61c2":function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"settings-container"},[o("el-header",[o("div",{staticClass:"settings-header"},[o("h3",[e._v("Settings")]),e._v(" "),o("el-button",{attrs:{type:"danger"},domProps:{textContent:e._s("Add new moderator")},on:{click:e.showCreateModeratorModal}})],1)]),e._v(" "),o("el-main",[o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.moderators.docs,border:"",fit:"","highlight-current-row":""}},[o("el-table-column",{attrs:{align:"center",label:"ID",width:"80",type:"index",index:e.indexMethod}}),e._v(" "),o("el-table-column",{attrs:{label:"LOGIN",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n\t\t\t\t\t\t"+e._s(t.row.login)+"\n\t\t\t\t\t")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"CATEGORY",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("ul",e._l(t.row.allowedCategories,function(t,r){return o("li",{key:r,domProps:{textContent:e._s(t.title)}})}),0)]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"ARTICLES","min-width":"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n\t\t\t\t\t\t"+e._s(t.row.articles)+"\n\t\t\t\t\t")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"SETTINGS",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticClass:"table-btns-wrapper"},[o("el-button",{attrs:{circle:""},on:{click:function(o){return e.showPermissionModal(t.row)}}},[o("svg-icon",{attrs:{"icon-class":"user"}})],1),e._v(" "),o("el-button",{attrs:{circle:""},on:{click:function(o){return e.showPasswordModal(t.row)}}},[o("svg-icon",{attrs:{"icon-class":"password"}})],1),e._v(" "),o("el-button",{attrs:{icon:"el-icon-delete",circle:""},on:{click:function(o){return e.handlerDelete(t.row)}}})],1)]}}])})],1)],1),e._v(" "),o("el-footer",[o("el-pagination",{attrs:{"current-page":e.pagination_page,layout:"prev, pager, next",total:e.moderators.totalDocs},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.pagination_page=t},"update:current-page":function(t){e.pagination_page=t}}})],1),e._v(" "),o("el-dialog",{attrs:{title:"Permission",visible:e.modal.permission,width:"75%","before-close":e.closePermissionModal},on:{"update:visible":function(t){return e.$set(e.modal,"permission",t)}}},[o("el-form",{ref:"editableUser",attrs:{model:e.permissionData,"label-width":"150px"}},e._l(e.categories,function(t,r){return o("el-form-item",{key:r,attrs:{label:t.title}},[o("switch-el",{attrs:{category:t,allowed:e.permissionData.categories},on:{switch:e.switchHandler}})],1)}),1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closePermissionModal}},[e._v("Cancel")]),e._v(" "),o("el-button",{attrs:{type:"success",plain:""},domProps:{textContent:e._s("Confirm")},on:{click:e.handleConfirmPermissions}})],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"Password",visible:e.modal.password,width:"75%","before-close":e.closePasswordModal},on:{"update:visible":function(t){return e.$set(e.modal,"password",t)}}},[o("el-form",{ref:"editableUser",attrs:{model:e.passwordData,rules:e.passwordRules,"label-width":"150px"}},[o("el-form-item",{attrs:{label:"Password",prop:"password"}},[o("el-input",{attrs:{placeholder:"Enter new password"},model:{value:e.passwordData.password,callback:function(t){e.$set(e.passwordData,"password",t)},expression:"passwordData.password"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closePasswordModal}},[e._v("Cancel")]),e._v(" "),o("el-button",{attrs:{type:"success",plain:""},domProps:{textContent:e._s("Confirm")},on:{click:e.handleConfirmPassword}})],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"New moderator",visible:e.modal.create_moderator,width:"75%","before-close":e.closeCreateModeratorModal},on:{"update:visible":function(t){return e.$set(e.modal,"create_moderator",t)}}},[o("el-form",{ref:"createModerator",attrs:{model:e.createModerator,rules:e.moderatorRules,"label-width":"150px"}},[o("el-form-item",{attrs:{label:"Nickname",prop:"login"}},[o("el-input",{attrs:{placeholder:"Enter moderator nickname"},model:{value:e.createModerator.login,callback:function(t){e.$set(e.createModerator,"login",t)},expression:"createModerator.login"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Password",prop:"password"}},[o("el-input",{attrs:{placeholder:"Password"},model:{value:e.createModerator.password,callback:function(t){e.$set(e.createModerator,"password",t)},expression:"createModerator.password"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Email",prop:"email"}},[o("el-input",{attrs:{placeholder:"Enter email"},model:{value:e.createModerator.email,callback:function(t){e.$set(e.createModerator,"email",t)},expression:"createModerator.email"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeCreateModeratorModal}},[e._v("Cancel")]),e._v(" "),o("el-button",{attrs:{type:"success",plain:""},domProps:{textContent:e._s("Confirm")},on:{click:e.handleCreateModerator}})],1)],1)],1)},a=[],s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-switch",{model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})},i=[],n=(o("ac6a"),{props:{category:[Array,Object],allowed:[Array,Object]},computed:{value:{get:function(){var e=this,t=!1;return this.allowed.forEach(function(o){o._id==e.category._id&&(t=!0)}),t},set:function(e){this.$emit("switch",[e,this.category])}}}}),l=n,d=o("2877"),c=Object(d["a"])(l,s,i,!1,null,null,null),u=c.exports,p=(o("2f62"),{name:"Settings",components:{SwitchEl:u},computed:{moderators:function(){return this.$store.state.users.users},categories:function(){return this.$store.state.home.categories.docs}},data:function(){var e=function(e,t,o){t.trim().length>0?o():o(new Error("Please enter the correct user name"))},t=function(e,t,o){t.trim().length>0?o():o(new Error("Please enter the correct password"))},o=function(e,t,o){t.trim().length>0?o():o(new Error("Please enter the correct email"))};return{pagination_page:1,loading:!0,modal:{permission:!1,password:!1,create_moderator:!1},permissionData:{categories:[]},passwordData:{password:""},passwordRules:{password:[{required:!0,trigger:"blur",validator:t}]},createModerator:{login:"",email:"",password:""},moderatorRules:{login:[{required:!0,trigger:"blur",validator:e}],email:[{required:!0,trigger:"blur",validator:o}],password:[{required:!0,trigger:"blur",validator:t}]}}},methods:{indexMethod:function(e){return 10*(this.pagination_page-1)+e+1},showPermissionModal:function(e){this.modal.permission=!0,this.editable_moderator=e,this.permissionData.categories=e.allowedCategories.slice(0,e.allowedCategories.length)},closePermissionModal:function(){this.modal.permission=!1},handleConfirmPermissions:function(){var e=this,t={userId:this.editable_moderator._id,allowedCategories:this.permissionData.categories};this.loading=!0,this.$store.dispatch("users/setAllowedCategories",t).then(function(){e.$store.dispatch("users/getUsers",{limit:10,page:e.pagination_page,moderator:!0}).then(function(){e.loading=!1,e.closePermissionModal()})})},switchHandler:function(e){if(e[0])this.permissionData.categories.push(e[1]);else{var t=this.permissionData.categories.filter(function(t){return t._id!=e[1]._id});this.permissionData.categories=t}},showPasswordModal:function(e){this.modal.password=!0,this.editable_moderator=e},closePasswordModal:function(){this.modal.password=!1},handleConfirmPassword:function(){var e=this;this.$refs.editableUser.validate(function(t){if(t){var o={login:e.editable_moderator.login,email:e.editable_moderator.email,moderator:!0,password:e.passwordData.password};e.$store.dispatch("users/updateUser",[o,e.editable_moderator._id]).then(function(){e.$store.dispatch("users/getUsers",{limit:10,page:e.pagination_page}).then(function(){e.loading=!1,e.closePasswordModal()})})}})},handlerDelete:function(e){var t=this;this.loading=!0,this.$store.dispatch("users/deleteUser",e._id).then(function(){t.$store.dispatch("users/getUsers",{limit:10,page:t.pagination_page}).then(function(){t.loading=!1})})},showCreateModeratorModal:function(){this.modal.create_moderator=!0},closeCreateModeratorModal:function(){this.$refs.createModerator.resetFields(),this.modal.create_moderator=!1},handleCreateModerator:function(){var e=this;this.$refs.createModerator.validate(function(t){if(t){var o={login:e.createModerator.login,email:e.createModerator.email,password:e.createModerator.password,moderator:!0};e.loading=!0,e.$store.dispatch("users/createUser",o).then(function(){e.$store.dispatch("users/getUsers",{limit:10,page:e.pagination_page}).then(function(){e.loading=!1,e.closeCreateModeratorModal()})})}})},handleCurrentChange:function(e){var t=this;this.loading=!0,this.$store.dispatch("users/getUsers",{limit:10,page:this.pagination_page}).then(function(){t.loading=!1})}},created:function(){var e=this,t={limit:10,page:1,moderator:!0};this.$store.dispatch("users/getUsers",t).then(function(){e.loading=!1})}}),m=p,h=(o("b70d"),Object(d["a"])(m,r,a,!1,null,"b81f4600",null));t["default"]=h.exports},b70d:function(e,t,o){"use strict";var r=o("fa95"),a=o.n(r);a.a},fa95:function(e,t,o){}}]);